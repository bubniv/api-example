<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:rich="http://richfaces.org/rich" xmlns:a4j="http://richfaces.org/a4j"
      xmlns:calendar="http://java.sun.com/jsf/composite/calendar">
<f:metadata>
    <f:viewParam name="creativeId" value="#{campaignDetailsCreativePage.creativeId}"/>
    <f:viewParam name="campaignKey" value="#{campaignDetailsCreativePage.campaignKey}"/>
</f:metadata>

<ui:composition template="/templates/template.xhtml">

    <ui:param name="onload" value="graph();"/>

    <ui:define name="title">Creative Information</ui:define>
    <ui:define name="scripts">
        <script type="text/javascript">
            function createChart(data) {
                var jsonData = JSON.parse(data);
                $.plot($("#creativeGraph"),
                        [
                            { data: jsonData['bids'], label: 'Bids', yaxis: 1 },
                            { data: jsonData['wins'], label: 'Wins', yaxis: 1 },
                            { data: jsonData['clicks'], label: 'Clicks', yaxis: 2 }
                        ],
                        {
                            yaxes: [
                                { position: 'left' },
                                { position: 'right' }
                            ],
                            xaxis: { minTickSize: 1 }
                        });
            }
        </script>
    </ui:define>

    <ui:define name="title">Creative Information</ui:define>
    <ui:define name="body">
        <h:form>
            <h:outputScript library="default" name="js/flot/jquery.flot.js"/>
            <calendar:calendar renderValue="creativeHourlyTable"/>

            <rich:panel header="Navigation">
                Previous:
                <h:link value="#{campaignDetailsCreativePage.findPrev(campaignDetailsCreativePage.creativeId)}">
                    <f:param name="campaignKey" value="#{campaignKey}"/>
                    <f:param name="creativeId"
                             value="#{campaignDetailsCreativePage.findPrev(campaignDetailsCreativePage.creativeId)}"/>
                    <f:param name="cid" value="#{campaignsPage.cid}"/>
                </h:link>

                This CreativeId: <h:outputText value="#{campaignDetailsCreativePage.creativeId}"/>

                Next: <h:link value="#{campaignDetailsCreativePage.findNext(campaignDetailsCreativePage.creativeId)}">
                <f:param name="campaignKey" value="#{campaignKey}"/>
                <f:param name="creativeId"
                         value="#{campaignDetailsCreativePage.findNext(campaignDetailsCreativePage.creativeId)}"/>
                <f:param name="cid" value="#{campaignsPage.cid}"/>
            </h:link>
            </rich:panel>

            <rich:panel style="width: 49%; display: inline-block; " header="Creative Hourly Statistics">
                <rich:dataTable id="creativeHourlyTable"
                                value="#{campaignDetailsCreativePage.getSelectedCreative(campaignDetailsCreativePage.getCreativeId(), advertiserKey, campaignDetailsCreativePage.getCampaignKey()).statsList}"
                                var="creativeHourStats">
                    <rich:column>
                        <f:facet name="header">Hour</f:facet>
                        <h:outputText value="#{creativeHourStats.hour}"/>
                    </rich:column>

                    <rich:column>
                        <f:facet name="header">Clicks</f:facet>
                        <h:outputText value="#{creativeHourStats.stats.clicks}"/>
                    </rich:column>

                    <rich:column>
                        <f:facet name="header">Impressions Bid</f:facet>
                        <h:outputText value="#{creativeHourStats.stats.impressionsBid}"/>
                    </rich:column>

                    <rich:column>
                        <f:facet name="header">Impressions Won</f:facet>
                        <h:outputText value="#{creativeHourStats.stats.impressionsWon}"/>
                    </rich:column>

                    <rich:column>
                        <f:facet name="header">Auctions Spend</f:facet>
                        <h:outputText value="#{creativeHourStats.stats.auctionsSpend}"/>
                    </rich:column>

                </rich:dataTable>
            </rich:panel>

            <rich:panel name="graphRegion" style="width: 50%; display: inline-block;" header="Graphs">
                <div id="creativeGraph" style="height: 400px; width: 650px;"></div>
            </rich:panel>

            <a4j:jsFunction name="graph" reRender="graphRegion"
                            data="#{campaignDetailsGraph.getData(campaignDetailsCreativePage.getSelectedCreative(campaignDetailsCreativePage.creativeId, advertiserKey, campaignDetailsCreativePage.campaignKey))}"
                            oncomplete="createChart(event.data);"/>
        </h:form>
    </ui:define>
</ui:composition>

</html>